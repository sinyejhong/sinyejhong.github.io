---
import BaseLayout from "../layouts/BaseLayout.astro";
import SectionHeader from "../components/SectionHeader.astro";
import AwardCard from "../components/AwardCard.astro";
import awards from "../data/awards.json";

// Filter for 2025+ and sort by year descending, excluding PI awards
const sortedAwards = [...awards]
    .filter(
        (a) =>
            a.year >= 2025 &&
            (a.category === "student_merit" ||
                a.category === "paper" ||
                a.category === "competition"),
    )
    .sort((a, b) => b.year - a.year);

const meritAwards = sortedAwards.filter((a) => a.category === "student_merit");
const paperAwards = sortedAwards.filter((a) => a.category === "paper");
const competitionAwards = sortedAwards.filter(
    (a) => a.category === "competition",
);
---

<BaseLayout
    title="Lab & Student Awards"
    description="Student achievements and lab team recognitions of ASI¬≤ LAB"
>
    <!-- Hero -->
    <section class="bg-gradient-to-br from-navy to-navy-light text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1
                class="text-4xl md:text-5xl font-heading font-bold mb-4 text-white"
            >
                Lab & Student Awards
            </h1>
            <p class="text-xl text-gray-300 max-w-3xl mx-auto mb-4">
                Celebrating our students' excellence and team achievements under
                Dr. Jhong's guidance
            </p>
            <p class="text-gray-400 max-w-2xl mx-auto mb-8">
                Competition wins and recognitions achieved by ASI¬≤ LAB members.
                For the PI's personal academic honors, visit
                <a href="/about#honors" class="text-accent hover:underline"
                    >Personal Honors & Awards</a
                >.
            </p>

            <!-- Total Counter -->
            <div
                class="inline-flex items-center gap-3 px-8 py-4 bg-white/10 rounded-2xl backdrop-blur-sm border border-white/20"
            >
                <div class="text-5xl font-heading font-bold text-accent">
                    {sortedAwards.length}
                </div>
                <div class="text-left">
                    <div class="text-xl font-semibold">Total Awards</div>
                    <div class="text-gray-400 text-sm">(2025 - Present)</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filter Tabs -->
    <section
        class="sticky top-12 lg:top-14 z-40 bg-white border-b border-gray-border shadow-sm"
    >
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-wrap justify-center gap-2" id="award-filters">
                <button
                    class="filter-btn active px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-200 bg-accent text-white shadow-lg shadow-accent/30"
                    data-filter="all"
                >
                    All ({sortedAwards.length})
                </button>
                <button
                    class="filter-btn px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-200 bg-gray-100 text-gray-700 hover:bg-gray-200"
                    data-filter="student_merit"
                >
                    üèÖ Student Merit Awards ({meritAwards.length})
                </button>
                <button
                    class="filter-btn px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-200 bg-gray-100 text-gray-700 hover:bg-gray-200"
                    data-filter="paper"
                >
                    üìÑ Paper Awards ({paperAwards.length})
                </button>
                <button
                    class="filter-btn px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-200 bg-gray-100 text-gray-700 hover:bg-gray-200"
                    data-filter="competition"
                >
                    üèÜ Competition Awards ({competitionAwards.length})
                </button>
            </div>
        </div>
    </section>

    <!-- Awards List by Year -->
    <section class="section-padding bg-gray-bg">
        <div
            class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8"
            id="awards-container"
        >
            {
                [...new Set(sortedAwards.map((a) => a.year))].map((year) => {
                    const yearAwards = sortedAwards.filter((a) => a.year === year);
                    return (
                        <div class="year-group mb-10 last:mb-0" data-year={year}>
                            <!-- Year Header (Publications Style) -->
                            <div class="year-header flex items-center gap-4 mb-6 py-2">
                                <div class="text-2xl font-bold text-navy">{year}</div>
                                <div class="flex-1 h-px bg-gradient-to-r from-accent/50 to-transparent"></div>
                                <span class="text-sm text-gray-400 font-medium year-count">
                                    {yearAwards.length} {yearAwards.length > 1 ? 'awards' : 'award'}
                                </span>
                            </div>
                            
                            <!-- Awards Grid -->
                            <div class="grid md:grid-cols-2 gap-6 awards-grid">
                                {yearAwards.map((award) => (
                                    <div
                                        class="award-item"
                                        data-category={award.category}
                                    >
                                        <AwardCard
                                            title={award.title}
                                            event={award.event}
                                            year={award.year}
                                            category={award.category}
                                            description={award.description}
                                        />
                                    </div>
                                ))}
                            </div>
                        </div>
                    );
                })
            }
        </div>
    </section>
</BaseLayout>

<script>
    const filterBtns = document.querySelectorAll(".filter-btn");
    const yearGroups = document.querySelectorAll(".year-group");

    filterBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            // Update active button
            filterBtns.forEach((b) => {
                b.classList.remove(
                    "active",
                    "bg-accent",
                    "text-white",
                    "shadow-lg",
                    "shadow-accent/30",
                );
                b.classList.add(
                    "bg-gray-100",
                    "text-gray-700",
                    "hover:bg-gray-200",
                );
            });
            btn.classList.add(
                "active",
                "bg-accent",
                "text-white",
                "shadow-lg",
                "shadow-accent/30",
            );
            btn.classList.remove(
                "bg-gray-100",
                "text-gray-700",
                "hover:bg-gray-200",
            );

            const filter = btn.getAttribute("data-filter");

            yearGroups.forEach((group) => {
                const items = group.querySelectorAll(".award-item");
                let visibleCount = 0;

                items.forEach((item) => {
                    if (
                        filter === "all" ||
                        item.getAttribute("data-category") === filter
                    ) {
                        item.classList.remove("hidden");
                        visibleCount++;
                    } else {
                        item.classList.add("hidden");
                    }
                });

                // Update year count
                const yearCountEl = group.querySelector(".year-count");
                if (yearCountEl) {
                    yearCountEl.textContent = `${visibleCount} ${visibleCount === 1 ? 'award' : 'awards'}`;
                }

                if (visibleCount > 0) {
                    group.classList.remove("hidden");
                } else {
                    group.classList.add("hidden");
                }
            });
        });
    });
</script>
