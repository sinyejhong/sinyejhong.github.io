---
interface LinkItem {
    label: string;
    url: string;
    icon?: string;
}

interface Props {
    name: string;
    photo: string;
    role: string;
    topic: string;
    email?: string;
    coadvisor?: string;
    research_group?: string;
    affiliations?: string[];
    links?: LinkItem[];
    isDirector?: boolean;
}

const {
    name,
    photo,
    role,
    topic,
    email,
    coadvisor,
    research_group,
    affiliations = [],
    links = [],
    isDirector = false,
} = Astro.props;

// Tailwind Safelist - these dynamic classes must be available at build time:
// group-hover:border-blue-700 group-hover:border-emerald-700 group-hover:border-purple-700
// group-hover:bg-blue-50/50 group-hover:bg-emerald-50/50 group-hover:bg-purple-50/50
// group-hover:text-blue-900 group-hover:text-emerald-900 group-hover:text-purple-900
// group-hover:text-blue-800 group-hover:text-emerald-800 group-hover:text-purple-800
// group-hover:ring-blue-400/40 group-hover:ring-emerald-400/40 group-hover:ring-purple-400/40

// Split topics string into an array, robustly handling commas
const topicTags = topic
    ? topic
          .split(",")
          .map((t) => t.trim())
          .filter(Boolean)
    : [];

// Research area labels and styling (Copied from PublicationItem)
// Research area labels and styling (Copied from PublicationItem)
const researchAreaConfig = {
    perception: {
        label: "Resilient Perception",
        url: "/research#perception",
        bgClass: "bg-blue-100",
        textClass: "text-blue-700",
        spacingClass: "gap-1",
        icon: `<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" /></svg>`,
        // Theme Colors
        borderHover: "group-hover:border-blue-300",
        shadowHover: "hover:shadow-blue-500/20",
        badgeStyle:
            "group-hover:bg-blue-50 group-hover:text-blue-700 group-hover:border-blue-100",
        ringHover: "group-hover:ring-blue-400",
        gradient: "from-blue-600 to-indigo-600",
        buttonHover: "hover:shadow-blue-500/25",
        iconColor: "text-blue-500",
        glowClass: "bg-blue-400/30",
        ringClass: "group-hover:ring-blue-400/40",
        borderClass: "border-gray-200 group-hover:border-blue-700",
        // Text & UI Colors
        nameHover: "group-hover:text-blue-900",
        roleColor: "text-blue-800",
        emailHover: "group-hover:text-blue-800",
        bgTint: "group-hover:bg-blue-50/50",
    },
    aiot: {
        label: "Industrial AIoT",
        url: "/research#inspection",
        bgClass: "bg-emerald-100",
        textClass: "text-emerald-700",
        spacingClass: "-space-y-2",
        icon: `<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>`,
        // Theme Colors
        borderHover: "group-hover:border-emerald-300",
        shadowHover: "hover:shadow-emerald-500/20",
        badgeStyle:
            "group-hover:bg-emerald-50 group-hover:text-emerald-700 group-hover:border-emerald-100",
        ringHover: "group-hover:ring-emerald-400",
        gradient: "from-emerald-600 to-teal-600",
        buttonHover: "hover:shadow-emerald-500/25",
        iconColor: "text-emerald-500",
        glowClass: "bg-emerald-400/30",
        ringClass: "group-hover:ring-emerald-400/40",
        borderClass: "border-gray-200 group-hover:border-emerald-700",
        // Text & UI Colors
        nameHover: "group-hover:text-emerald-900",
        roleColor: "text-emerald-800",
        emailHover: "group-hover:text-emerald-800",
        bgTint: "group-hover:bg-emerald-50/50",
    },
    embodied: {
        label: "Embodied AI",
        url: "/research#robotics",
        bgClass: "bg-purple-100",
        textClass: "text-purple-700",
        spacingClass: "gap-1",
        icon: `<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>`,
        // Theme Colors
        borderHover: "group-hover:border-purple-300",
        shadowHover: "hover:shadow-purple-500/20",
        badgeStyle:
            "group-hover:bg-purple-50 group-hover:text-purple-700 group-hover:border-purple-100",
        ringHover: "group-hover:ring-purple-400",
        gradient: "from-purple-600 to-fuchsia-600",
        buttonHover: "hover:shadow-purple-500/25",
        iconColor: "text-purple-500",
        glowClass: "bg-purple-400/30",
        ringClass: "group-hover:ring-purple-400/40",
        borderClass: "border-gray-200 group-hover:border-purple-700",
        // Text & UI Colors
        nameHover: "group-hover:text-purple-900",
        roleColor: "text-purple-800",
        emailHover: "group-hover:text-purple-800",
        bgTint: "group-hover:bg-purple-50/50",
    },
};

const getAreaKey = (group: string | undefined) => {
    if (!group) return null;
    const g = group.toLowerCase();
    if (g.includes("perception") || g.includes("driving")) return "perception";
    if (g.includes("inspection") || g.includes("aiot") || g.includes("smart"))
        return "aiot";
    if (g.includes("embodied") || g.includes("robot")) return "embodied";
    return null;
};

const areaKey = getAreaKey(research_group);
const areaConfig = areaKey
    ? researchAreaConfig[areaKey as keyof typeof researchAreaConfig]
    : null;
---

<div
    class:list={[
        "group relative overflow-hidden transition-all duration-300 isolate cursor-pointer member-card",
        isDirector
            ? "bg-white rounded-2xl shadow-sm hover:-translate-y-1 py-5 px-4 border-2 h-full flex flex-col hover:shadow-xl border-amber-200 hover:border-amber-500 hover:bg-amber-50/30"
            : "bg-white rounded-2xl shadow-sm hover:-translate-y-1 p-4 border-2 h-full flex flex-col hover:shadow-xl border-gray-200",
        !isDirector &&
            areaKey === "perception" &&
            "hover:border-blue-700 hover:bg-blue-50/50",
        !isDirector &&
            areaKey === "aiot" &&
            "hover:border-emerald-700 hover:bg-emerald-50/50",
        !isDirector &&
            areaKey === "embodied" &&
            "hover:border-purple-700 hover:bg-purple-50/50",
    ]}
    onclick={!isDirector && areaConfig
        ? `window.location.href='${areaConfig.url}'`
        : undefined}
>
    <!-- Research Watermark (Publication Style) -->
    {
        areaConfig && (
            <div
                class:list={[
                    "absolute -bottom-6 -right-2 flex flex-col items-end gap-1 p-4 opacity-5 group-hover:opacity-20 transition-all duration-500 z-10 pointer-events-none",
                    areaConfig.textClass,
                    areaConfig.spacingClass,
                ]}
            >
                <div class="w-40 h-40 transform rotate-12 transition-transform duration-500 group-hover:rotate-0 group-hover:scale-110">
                    <Fragment set:html={areaConfig.icon} />
                </div>
                <span class="text-sm font-bold tracking-widest uppercase text-right pr-2 pb-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-y-2 group-hover:translate-y-0">
                    {areaConfig.label}
                </span>
            </div>
        )
    }

    {
        isDirector ? (
            <>
                {/* Director Gold Star Watermark */}
                <div class="absolute -bottom-6 -right-2 flex flex-col items-end gap-1 p-4 opacity-5 group-hover:opacity-20 transition-all duration-500 pointer-events-none z-0 text-amber-600">
                    <div class="w-40 h-40 transform rotate-12 transition-transform duration-500 group-hover:rotate-0 group-hover:scale-110">
                        <svg
                            class="w-full h-full"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="1.5"
                                d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"
                            />
                        </svg>
                    </div>
                    <span class="text-sm font-bold tracking-widest uppercase text-right pr-2 pb-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-y-2 group-hover:translate-y-0">
                        Lab Director
                    </span>
                </div>

                <div class="flex flex-col sm:flex-row items-center sm:items-start gap-6 h-full relative z-10">
                    {/* Left Column: Photo + Role Badge */}
                    <div class="flex flex-col items-center text-center flex-shrink-0">
                        {/* Image */}
                        <div class="relative mb-2 group-hover:-translate-y-1 transition-transform duration-300">
                            <div class="w-28 h-28 rounded-full overflow-hidden border-3 border-white shadow-lg relative z-10 transition-all duration-300 group-hover:ring-4 group-hover:ring-amber-400/40">
                                <img
                                    src={photo}
                                    alt={name}
                                    class="w-full h-full object-cover"
                                    loading="eager"
                                />
                            </div>
                            {/* Decorative blur pulsing */}
                            <div class="absolute inset-0 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 scale-125 -z-10 bg-amber-400/30" />
                        </div>

                        {/* Role Badge */}
                        <span class="inline-block px-2.5 py-1 rounded-md text-xs font-semibold tracking-wide transition-colors bg-amber-100 text-amber-700 group-hover:bg-amber-200 group-hover:text-amber-800">
                            {role}
                        </span>
                    </div>

                    {/* Right Column: Name + Affiliations + Email + Links */}
                    <div class="flex flex-col justify-start flex-grow space-y-2 text-center sm:text-left w-full">
                        {/* Name */}
                        <h3 class="text-2xl font-bold text-slate-900 transition-colors font-serif group-hover:text-amber-700 mb-1">
                            {name}
                        </h3>

                        {/* Affiliations List */}
                        {affiliations.length > 0 && (
                            <div class="space-y-1">
                                {affiliations.map((affiliation: string) => (
                                    <div class="flex items-center justify-center sm:justify-start">
                                        <span class="text-base font-medium text-slate-500 group-hover:text-amber-700 transition-colors">
                                            {affiliation}
                                        </span>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Email */}
                        {email && (
                            <a
                                href={`mailto:${email}`}
                                class="flex items-center justify-center sm:justify-start gap-2 text-sm font-medium text-slate-400 transition-colors hover:underline group-hover:text-amber-800"
                            >
                                <svg
                                    class="w-5 h-5 flex-shrink-0 text-slate-400 group-hover:text-amber-600 transition-colors"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                                    />
                                </svg>
                                {email}
                            </a>
                        )}

                        {/* External Links */}
                        {links.length > 0 && (
                            <div class="flex flex-wrap justify-center sm:justify-start gap-3 mt-0">
                                {links.map((link: LinkItem) => (
                                    <a
                                        href={link.url}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        class="flex items-center gap-1.5 text-sm font-medium text-slate-400 transition-colors hover:underline group-hover:text-amber-800"
                                    >
                                        {/* Scholar Icon - Graduation Cap */}
                                        {link.icon === "scholar" && (
                                            <svg
                                                class="w-4 h-4 flex-shrink-0 text-slate-400 group-hover:text-amber-600 transition-colors"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M12 14l9-5-9-5-9 5 9 5z"
                                                />
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"
                                                />
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998a12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"
                                                />
                                            </svg>
                                        )}
                                        {/* University Icon - Building */}
                                        {link.icon === "university" && (
                                            <svg
                                                class="w-4 h-4 flex-shrink-0 text-slate-400 group-hover:text-amber-600 transition-colors"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                                                />
                                            </svg>
                                        )}
                                        {/* ID Card Icon - for NSTC */}
                                        {link.icon === "id-card" && (
                                            <svg
                                                class="w-4 h-4 flex-shrink-0 text-slate-400 group-hover:text-amber-600 transition-colors"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"
                                                />
                                            </svg>
                                        )}
                                        {/* Default External Link Icon */}
                                        {!link.icon && (
                                            <svg
                                                class="w-4 h-4 flex-shrink-0 text-slate-400 group-hover:text-amber-600 transition-colors"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                                                />
                                            </svg>
                                        )}
                                        {link.label}
                                    </a>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            </>
        ) : (
            <>
                <div class="flex flex-col items-center text-center h-full relative z-10">
                    {/* Image */}
                    <div class="relative mb-4 group-hover:-translate-y-1 transition-transform duration-300">
                        <div
                            class={`w-24 h-24 rounded-full overflow-hidden border-3 border-white shadow-lg relative z-10 transition-all duration-300 ${areaConfig ? areaConfig.ringClass : "group-hover:ring-4 group-hover:ring-cyan-500/20"}`}
                        >
                            <img
                                src={photo}
                                alt={name}
                                class="w-full h-full object-cover"
                                loading="lazy"
                            />
                        </div>
                        {/* Decorative blur pulsing */}
                        <div
                            class={`absolute inset-0 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 scale-125 -z-10 ${areaConfig ? areaConfig.glowClass : "bg-cyan-400/20"}`}
                        />
                    </div>

                    {/* Content */}
                    <div class="flex-grow flex flex-col items-center w-full">
                        {/* Co-advisor Kicker */}
                        {coadvisor && (
                            <span
                                class={`inline-block px-2.5 py-1 rounded-md text-xs font-semibold tracking-wide mb-2 transition-colors bg-slate-100 text-slate-600 ${areaConfig ? `group-hover:bg-${areaConfig.bgClass.replace("bg-", "")} group-hover:text-${areaConfig.textClass.replace("text-", "")}` : ""}`}
                            >
                                {coadvisor}
                            </span>
                        )}

                        {/* Name */}
                        <h3
                            class={`text-2xl font-bold text-slate-900 mb-1 transition-colors font-serif ${areaConfig ? areaConfig.nameHover : "group-hover:text-slate-700"}`}
                        >
                            {name}
                        </h3>

                        {/* Role - Clear Text */}
                        <p
                            class={`text-base font-medium mb-2 text-slate-500 transition-colors ${areaConfig ? areaConfig.roleColor.replace("text-", "group-hover:text-") : ""}`}
                        >
                            {role}
                        </p>

                        {/* Email - Clear Text Link */}
                        {email && (
                            <a
                                href={`mailto:${email}`}
                                class={`flex items-center justify-center gap-2 text-sm font-medium text-slate-400 transition-colors group/link hover:underline ${areaConfig ? areaConfig.emailHover : "group-hover:text-slate-800"}`}
                                onclick="event.stopPropagation()"
                            >
                                <svg
                                    class="w-4 h-4 transition-colors text-slate-400 group-hover/link:text-slate-600"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                                    />
                                </svg>
                                {email}
                            </a>
                        )}
                    </div>
                </div>
            </>
        )
    }
</div>
