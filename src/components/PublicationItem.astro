---
interface Props {
    title: string;
    authors: string[];
    venue: string;
    venueDetail?: string;
    year: number;
    type: string;
    badges: string[];
    doi?: string;
    link?: string;
    highlight?: boolean;
    pdf?: string;
    code?: string;
    researchArea?: "perception" | "aiot" | "embodied";
}

const {
    title,
    authors,
    venue,
    venueDetail,
    year,
    type,
    badges,
    doi,
    link = "#",
    highlight = false,
    pdf,
    code,
    researchArea,
} = Astro.props;

// Highlight PI name in author list (English + Traditional/Simplified Chinese)
const piNames = ["S.-Y. Jhong", "鍾昕燁", "钟昕烨"];
const highlightAuthor = (author: string) => {
    return piNames.some((name) => author.includes(name));
};

// Research area labels and styling
const researchAreaConfig = {
    perception: {
        label: "Resilient Perception",
        bgClass: "bg-blue-100",
        textClass: "text-blue-700",
        spacingClass: "gap-1",
        icon: `<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" /></svg>`,
        link: "/research#perception",
    },
    aiot: {
        label: "Industrial AIoT",
        bgClass: "bg-emerald-100",
        textClass: "text-emerald-700",
        spacingClass: "-space-y-2", // Closer!
        icon: `<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>`,
        link: "/research#inspection",
    },
    embodied: {
        label: "Embodied AI",
        bgClass: "bg-purple-100",
        textClass: "text-purple-700",
        spacingClass: "gap-1",
        icon: `<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>`,
        link: "/research#robotics",
    },
};

const areaConfig = researchArea ? researchAreaConfig[researchArea] : null;
---

<article
    class:list={[
        "group relative p-6 rounded-xl border-2 transition-all duration-300 cursor-pointer hover:-translate-y-0.5 overflow-hidden",
        highlight
            ? "border-yellow-400 bg-yellow-50 hover:border-yellow-500 hover:shadow-lg"
            : "border-gray-200 bg-white hover:border-accent/50 hover:shadow-lg",
    ]}
>
    <!-- Background Watermark (Clickable Pillar Graphic) -->
    {
        areaConfig && (
            <a
                href={areaConfig.link}
                class:list={[
                    "absolute -bottom-6 -right-2 flex flex-col items-end gap-1 p-4 opacity-20 group-hover:opacity-100 transition-all duration-500 pointer-events-auto z-0",
                    areaConfig.textClass,
                    areaConfig.spacingClass,
                ]}
                title={`Go to ${areaConfig.label}`}
            >
                <div class="w-32 h-32 transform rotate-12 transition-transform duration-500 group-hover:rotate-0 group-hover:scale-110">
                    <Fragment set:html={areaConfig.icon} />
                </div>
                <span class="text-xs font-bold tracking-widest uppercase text-right pr-2 pb-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-y-2 group-hover:translate-y-0">
                    {areaConfig.label}
                </span>
            </a>
        )
    }

    <!-- Main Content (Wrapper for z-index) -->
    <div class="relative z-10 pointer-events-none">
        <!-- Badges Row -->
        <div class="flex flex-wrap items-center gap-2 mb-3 pointer-events-auto">
            <!-- 1. Year -->
            <span class="badge bg-gray-100 text-gray-600 font-medium">
                {year}
            </span>

            <!-- 2. Type -->
            <span
                class:list={[
                    "badge",
                    type === "journal" &&
                        "bg-blue-50 text-blue-700 ring-1 ring-blue-100",
                    type === "conference" &&
                        "bg-indigo-50 text-indigo-700 ring-1 ring-indigo-100",
                    type === "patent" &&
                        "bg-lime-50 text-lime-700 ring-1 ring-lime-100",
                ]}
            >
                {type.charAt(0).toUpperCase() + type.slice(1)}
            </span>

            <!-- 4. Other Badges (Awards, Metrics) -->
            {
                badges.map((badge) => (
                    <span
                        class:list={[
                            "badge",
                            badge === "SCI" &&
                                "bg-orange-50 text-orange-700 ring-1 ring-orange-100",
                            badge === "ESCI" &&
                                "bg-pink-50 text-pink-700 ring-1 ring-pink-100",
                            badge.includes("Q1") &&
                                "bg-emerald-50 text-emerald-700 font-semibold ring-1 ring-emerald-100",
                            badge.includes("Q2") &&
                                "bg-teal-50 text-teal-700 ring-1 ring-teal-100",
                            badge.includes("Q3") &&
                                "bg-cyan-50 text-cyan-700 ring-1 ring-cyan-100",
                            badge.includes("Q4") &&
                                "bg-sky-50 text-sky-700 ring-1 ring-sky-100",
                            badge === "Top Tier" &&
                                "bg-violet-50 text-violet-700 font-semibold ring-1 ring-violet-100",
                            badge === "Best Paper Award" &&
                                "bg-rose-50 text-rose-700 font-semibold ring-1 ring-rose-100",
                            badge === "Industry Collaboration" &&
                                "bg-fuchsia-50 text-fuchsia-700 ring-1 ring-fuchsia-100",
                            badge.startsWith("IF:") &&
                                "bg-slate-50 text-slate-600 border border-slate-200",
                        ]}
                    >
                        {badge}
                    </span>
                ))
            }

            <!-- 5. Featured -->
            {
                highlight && (
                    <span class="badge bg-amber-100 text-amber-800 font-semibold ring-1 ring-amber-200">
                        ★ Featured
                    </span>
                )
            }
        </div>

        <!-- Title -->
        <h3
            class="text-lg font-semibold text-navy mb-2 leading-snug group-hover:text-accent transition-colors pointer-events-auto"
        >
            <a
                href={link}
                target="_blank"
                rel="noopener noreferrer"
                class="hover:text-accent transition-colors"
            >
                {title}
            </a>
        </h3>

        <!-- Authors -->
        <p class="text-sm text-gray-text mb-2">
            {
                authors.map((author, index) => (
                    <>
                        {highlightAuthor(author) ? (
                            <span class="font-semibold text-accent">
                                {author}
                            </span>
                        ) : (
                            <span>{author}</span>
                        )}
                        {index < authors.length - 1 && ", "}
                    </>
                ))
            }
        </p>

        <!-- Venue -->
        <p class="text-sm font-medium text-navy/80 italic">
            {venue}{venueDetail && `, ${venueDetail}`}
        </p>

        <!-- DOI -->
        {
            doi && (
                <p class="text-xs text-gray-text mt-1 pointer-events-auto">
                    DOI:{" "}
                    <a
                        href={`https://doi.org/${doi}`}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-blue-600 hover:underline"
                    >
                        {doi}
                    </a>
                </p>
            )
        }

        <!-- Action Buttons -->
        {
            (pdf || code) && (
                <div class="flex items-center gap-2 mt-3 pt-3 border-t border-gray-100 pointer-events-auto">
                    {pdf && (
                        <a
                            href={pdf}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-1 px-2.5 py-1 text-xs font-medium bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors"
                        >
                            <svg
                                class="w-3.5 h-3.5"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"
                                />
                            </svg>
                            PDF
                        </a>
                    )}
                    {code && (
                        <a
                            href={code}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-1 px-2.5 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                        >
                            <svg
                                class="w-3.5 h-3.5"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"
                                />
                            </svg>
                            Code
                        </a>
                    )}
                </div>
            )
        }
    </div>
</article>
