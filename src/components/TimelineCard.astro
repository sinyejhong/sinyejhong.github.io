---
interface Props {
    title: string;
    organization: string;
    organizationUrl?: string;
    period: string;
    location: string;
    department?: string;
    iconType:
        | "phd"
        | "masters"
        | "bachelors"
        | "professor"
        | "research"
        | "visiting"
        | "industry"
        | "leadership";
    isCurrent?: boolean;
    category: "education" | "work";
    watermarkLogo?: string;
    watermarkOffset?: { bottom?: string; right?: string };
}

const {
    title,
    organization,
    organizationUrl,
    period,
    location,
    department,
    iconType,
    isCurrent = false,
    category,
    watermarkLogo,
    watermarkOffset = { bottom: "0.5rem", right: "0.5rem" },
} = Astro.props;

// Icon and color configuration based on type
const iconConfig: Record<
    string,
    { borderColor: string; iconBg: string; bgGradient: string }
> = {
    // Education
    phd: {
        borderColor: "border-l-accent",
        iconBg: "bg-accent",
        bgGradient: "bg-gradient-to-br from-white via-white to-rose-50/30",
    },
    masters: {
        borderColor: "border-l-navy",
        iconBg: "bg-navy",
        bgGradient: "bg-gradient-to-br from-white via-white to-blue-50/30",
    },
    bachelors: {
        borderColor: "border-l-gray-400",
        iconBg: "bg-gray-400",
        bgGradient: "bg-gradient-to-br from-white via-white to-gray-50/30",
    },
    // Work - Current positions
    professor: {
        borderColor: "border-l-accent",
        iconBg: "bg-accent",
        bgGradient: "bg-gradient-to-br from-white via-white to-rose-50/30",
    },
    // Work - Past positions
    research: {
        borderColor: "border-l-navy",
        iconBg: "bg-navy",
        bgGradient: "bg-gradient-to-br from-white via-white to-blue-50/30",
    },
    visiting: {
        borderColor: "border-l-blue-500",
        iconBg: "bg-blue-500",
        bgGradient: "bg-gradient-to-br from-white via-white to-blue-50/30",
    },
    industry: {
        borderColor: "border-l-emerald-500",
        iconBg: "bg-emerald-500",
        bgGradient: "bg-gradient-to-br from-white via-white to-emerald-50/30",
    },
    leadership: {
        borderColor: "border-l-gray-400",
        iconBg: "bg-gray-400",
        bgGradient: "bg-gradient-to-br from-white via-white to-gray-50/30",
    },
};

const config = iconConfig[iconType] || iconConfig.research;
---

<div
    class:list={[
        "group relative p-5 rounded-2xl border border-gray-100 shadow-sm hover:shadow-xl transition-all duration-300 cursor-default overflow-hidden",
        "border-l-4",
        config.borderColor,
        config.bgGradient,
    ]}
>
    <!-- Watermark Logo (Bottom Right) -->
    {
        watermarkLogo && (
            <div
                class="absolute w-24 h-24 opacity-[0.10] group-hover:opacity-[0.20] transition-all duration-500 pointer-events-none select-none transform rotate-[-5deg] group-hover:rotate-0 group-hover:scale-105"
                style={`bottom: ${watermarkOffset?.bottom || "0.5rem"}; right: ${watermarkOffset?.right || "0.5rem"};`}
            >
                <img
                    src={watermarkLogo}
                    alt=""
                    class="w-full h-full object-contain"
                    loading="lazy"
                />
            </div>
        )
    }

    <div class="relative z-10 flex items-start gap-4">
        <!-- Icon with background -->
        <div
            class:list={[
                "flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center transition-transform duration-300 group-hover:scale-110",
                config.iconBg,
            ]}
        >
            {
                iconType === "phd" && (
                    <svg
                        class="w-6 h-6 text-white"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 14l9-5-9-5-9 5 9 5z"
                        />
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"
                        />
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 14v7"
                        />
                    </svg>
                )
            }
            {
                iconType === "masters" && (
                    <svg
                        class="w-6 h-6 text-white"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 14l9-5-9-5-9 5 9 5z"
                        />
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"
                        />
                    </svg>
                )
            }
            {
                iconType === "bachelors" && (
                    <svg
                        class="w-6 h-6 text-white"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                        />
                    </svg>
                )
            }
            {
                iconType === "professor" && (
                    <svg
                        class="w-6 h-6 text-white"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                        />
                    </svg>
                )
            }
            {
                iconType === "research" && (
                    <svg
                        class="w-6 h-6 text-white"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"
                        />
                    </svg>
                )
            }
            {
                iconType === "visiting" && (
                    <svg
                        class="w-6 h-6 text-white"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                        />
                    </svg>
                )
            }
            {
                iconType === "industry" && (
                    <svg
                        class="w-6 h-6 text-white"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                        />
                    </svg>
                )
            }
            {
                iconType === "leadership" && (
                    <svg
                        class="w-6 h-6 text-white"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                        />
                    </svg>
                )
            }
        </div>

        <div class="flex-1 min-w-0">
            <!-- Meta badges and period -->
            <div class="flex items-center justify-between gap-2 mb-2 flex-wrap">
                <div class="flex items-center gap-2">
                    {
                        isCurrent && (
                            <span class="badge badge-ongoing text-xs">
                                Current
                            </span>
                        )
                    }
                </div>
                <span class="text-sm font-medium text-gray-500">{period}</span>
            </div>

            <!-- Title with hover effect -->
            <h3
                class="text-lg font-semibold text-navy mb-1.5 group-hover:text-accent transition-colors duration-200"
            >
                {title}
            </h3>

            <!-- Organization -->
            <p class="text-accent font-medium mb-1">
                {
                    organizationUrl ? (
                        <a
                            href={organizationUrl}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="hover:underline inline-flex items-center gap-1"
                        >
                            {organization}
                            <svg
                                class="w-3.5 h-3.5 opacity-50"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                                />
                            </svg>
                        </a>
                    ) : (
                        organization
                    )
                }
            </p>

            <!-- Department and Location -->
            <div
                class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 text-sm text-gray-500"
            >
                {department && <span>{department}</span>}
                <span class="flex items-center gap-1">
                    <svg
                        class="w-3.5 h-3.5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                        ></path>
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    {location}
                </span>
            </div>
        </div>
    </div>
</div>
